"use client";
import { useState, useEffect } from "react";
import styles from "./CostComparison.module.scss";
import Link from "next/link";

//#### State Type of retrieving data
interface BrokereArray {
  broker: string;
  symbol: string;
  cost: number;
  costPerLot: number;
  savingPercentage: number;
}
interface BrokerIndividualDataType {
  brokers: BrokereArray[];
  secondBestVsAfterprimePct?: number | null;
  top10VsAfterprimeAvgPct?: number | null;
  industryVsAfterprimeAvgPct?: number | null;
  rebate?: {
    symbol: string;
    product?: string;
    rebate_usd_per_lot?: number | null;
    effective_from?: string;
    effective_to?: string;
  };
}
// ####

export default function CostComparison({
  intrumentName,
}: {
  intrumentName: string;
}) {
  const [data, setData] = useState<BrokerIndividualDataType | null>(null);
  useEffect(() => {
    const controller = new AbortController();
    const dynamicInstrument = intrumentName.toLocaleLowerCase();
    const fetchData = async () => {
      try {
        const res = await fetch(`/api/brokers-compare`, {
          signal: controller.signal,
        });
        if (!res.ok) {
          return "Failed to Load brokers data";
        }
        const data = await res.json();
        setData(data);
      } catch (err) {
        console.error("Failed to load data", err);
        return "Internal Server Error";
      }
    };
    fetchData();
    return () => controller.abort();
  }, [intrumentName]);

  console.log("data:", data);

  return (
    <section className={`md:py-20!`}>
      {/* grain bg effect */}
      <div className="grainy_bg"></div>
      {/* grain bg effect */}

      <div className={`ap_container_small relative z-1 w-full`}>
        <h2 className={`text-center font-semibold max-md:leading-[1.2]`}>
          Compare {intrumentName} Broker Cost
        </h2>
        <div className={`${styles.costCompareTable}`}>
          <div
            className={`${styles.costCompareTableHead} grid grid-cols-12 gap-5`}
          >
            <div className={`col-span-4`}>
              <div
                className={`bg-[rgba(255,255,255,.1)] rounded-[5px] py-2 px-4 inline-block`}
              >
                in 30 Dyas
              </div>
            </div>
            <div className={`col-span-2`}>Avg. Spread</div>
            <div className={`col-span-2`}>Commission</div>
            <div className={`col-span-2`}>Est. All-in-Costs</div>
            <div className={`col-span-2`}>
              Flow Rewards<sup>TM</sup>
            </div>
          </div>
          <div className={`${styles.compareTableBody}`}>
            {/* #### */}
            <div
              className={`${styles.costCompareTableRow} ${styles.afterprime} grid grid-cols-12 gap-5`}
            >
              <div className={`col-span-4 relative`}>
                <div className={`${styles.isBest}`}>
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 14 14"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M1.65101 6.98611C1.24009 6.21353 0.256823 5.956 0 5.04454C1.28167 4.86781 2.55845 4.6229 3.84501 4.54211C4.65707 4.49161 5.03374 4.1028 5.34193 3.39838C5.84579 2.24707 6.43282 1.13111 6.98315 0C7.87103 1.06799 8.19145 2.46168 8.92278 3.62056C9.0622 3.96898 9.11601 4.38305 9.60031 4.43859C10.8477 4.58503 12.0952 4.74157 13.345 4.89306C14.1815 5.07232 14.1595 5.42579 13.6019 5.98882C13.3132 6.28169 12.8558 6.34481 12.6822 6.76646C12.1783 7.24112 11.694 7.74103 11.1633 8.17782C10.7621 8.50857 10.679 8.84941 10.7695 9.36952C11.0238 10.8516 11.2073 12.3488 11.4397 14C10.1433 13.2678 8.96436 12.6391 7.82945 11.9423C7.25465 11.5888 6.80704 11.6115 6.23714 11.9701C5.13402 12.6644 3.9722 13.2628 2.83484 13.9015C2.57068 13.5708 2.8006 13.2527 2.73211 12.9598C2.93757 11.6898 3.1308 10.4148 3.35827 9.14734C3.44143 8.6853 3.28245 8.4101 2.89354 8.23084C2.55601 7.73598 2.12307 7.34211 1.65345 6.98611H1.65101Z"
                      fill="white"
                      fillOpacity="0.68"
                    />
                  </svg>
                </div>
                <div className={``}>
                  <svg
                    width="115"
                    height="21"
                    viewBox="0 0 115 21"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M7.65951 12.6558C7.65951 13.2705 7.43889 13.7631 6.99807 14.1454C6.55683 14.5277 5.98036 14.7168 5.26908 14.7168C4.1856 14.7168 3.64427 14.2913 3.64427 13.44C3.64427 13.0223 3.79871 12.703 4.10839 12.4784C4.41766 12.2538 4.95164 12.0606 5.70991 11.8951C6.63854 11.6705 7.28854 11.4695 7.65951 11.2922V12.6558ZM11.2801 14.9612V9.18769C11.2801 7.70982 10.7772 6.61817 9.77171 5.91667C8.90477 5.29006 7.62111 4.97869 5.91868 4.97869C4.21666 4.97869 2.9048 5.34916 1.98433 6.09794C1.60187 6.40757 1.2948 6.75125 1.06323 7.12842C0.525213 8.00468 1.39089 8.91574 2.41913 8.91574C3.33149 8.91574 4.03482 8.03627 4.85963 7.6463C5.14827 7.50983 5.50906 7.4418 5.94196 7.4418C7.02503 7.4418 7.56677 7.85171 7.56677 8.67143C7.56677 9.04583 7.35433 9.31772 6.92862 9.48719C6.5025 9.66059 5.70991 9.81426 4.54922 9.94825C3.12542 10.1256 2.01171 10.4803 1.20727 11.0123C0.402424 11.5404 0 12.3877 0 13.5503C0 14.6577 0.371782 15.5169 1.11453 16.1277C1.85727 16.7386 2.83902 17.046 4.06222 17.046C5.65516 17.046 6.83138 16.5218 7.59006 15.4775H7.63663C7.69994 15.856 7.77177 16.1593 7.85177 16.3873C7.93716 16.6306 8.18297 16.7544 8.44087 16.7544H11.5962C11.6525 16.7544 11.698 16.7088 11.698 16.6526C11.698 16.6178 11.6798 16.586 11.653 16.5638C11.4048 16.3575 11.2801 15.8211 11.2801 14.9612Z"
                      fill="white"
                    />
                    <path
                      d="M14.4604 1.79637C13.8104 2.42305 13.4855 3.30986 13.4855 4.46075V5.28844H13.118C12.4748 5.28844 11.9533 5.80989 11.9533 6.45312C11.9533 7.09636 12.4748 7.6178 13.118 7.6178H13.4855V14.8622C13.4855 15.907 14.3325 16.754 15.3773 16.754C16.4221 16.754 17.2691 15.907 17.2691 14.8622V7.6178H18.3329C18.9762 7.6178 19.4976 7.09636 19.4976 6.45312C19.4976 5.80989 18.9762 5.28844 18.3329 5.28844H17.2691V4.72879C17.2691 4.13364 17.4395 3.75132 17.7799 3.58578C17.8778 3.53937 17.9948 3.50075 18.1309 3.46993C18.8628 3.30425 19.4976 2.76237 19.4976 2.01195C19.4976 1.33026 18.9803 0.750168 18.2987 0.737274C16.5188 0.703602 15.2393 1.05811 14.4604 1.79637Z"
                      fill="white"
                    />
                    <path
                      d="M25.6423 3.5079C25.6423 2.4887 24.8161 1.66248 23.7969 1.66248C22.7777 1.66248 21.9515 2.4887 21.9515 3.5079V5.28858H21.5157C20.8844 5.28858 20.3727 5.80032 20.3727 6.43159C20.3727 7.06285 20.8844 7.5746 21.5157 7.5746H21.9515V13.7311C21.9515 14.8938 22.28 15.7136 22.9378 16.1827C23.5957 16.6517 24.5281 16.8882 25.7351 16.8882C26.0761 16.8882 26.3838 16.8805 26.6581 16.865C27.3393 16.8267 27.8013 16.2374 27.8013 15.5552V14.3908C27.8013 14.1984 27.6455 14.0467 27.4532 14.0543C27.2518 14.0622 27.0892 14.0661 26.9654 14.0661C26.5318 14.0661 26.2029 13.9833 25.979 13.8217C25.7543 13.6562 25.6423 13.3646 25.6423 12.9468V7.5746H26.6583C27.2896 7.5746 27.8013 7.06285 27.8013 6.43159C27.8013 5.80032 27.2896 5.28858 26.6583 5.28858H25.6423V3.5079Z"
                      fill="white"
                    />
                    <path
                      d="M31.6289 9.7485C31.9076 8.25487 32.7202 7.51007 34.0659 7.51007C34.6845 7.51007 35.1992 7.71101 35.6094 8.11299C36.0192 8.51891 36.2549 9.06277 36.317 9.7485H31.6289ZM38.0579 6.34748C36.9752 5.38982 35.6213 4.91295 33.9965 4.91295C32.2013 4.91295 30.7354 5.4883 29.598 6.63513C28.4606 7.78589 27.8919 9.2244 27.8919 10.9584C27.8919 12.7358 28.4684 14.194 29.6213 15.3329C30.7734 16.4758 32.31 17.0472 34.2281 17.0472C35.6674 17.0472 36.905 16.6964 37.9419 15.995C38.4168 15.6783 38.8129 15.3206 39.1303 14.922C39.7111 14.1927 39.0333 13.2875 38.101 13.2875C36.9734 13.2875 35.9535 14.1679 34.8453 14.3767C34.669 14.4099 34.4788 14.4265 34.2747 14.4265C33.516 14.4265 32.913 14.2097 32.4644 13.7683C32.0154 13.3269 31.7294 12.7122 31.6052 11.92H38.2555C39.3245 11.92 40.2259 11.0517 40.0329 10.0003C39.7518 8.46824 39.0842 7.25111 38.0579 6.34748Z"
                      fill="white"
                    />
                    <path
                      d="M45.0919 7.08284H45.0224C45.0224 6.09252 44.211 5.2897 43.2207 5.2897C42.2208 5.2897 41.4015 6.10028 41.4015 7.10019V14.8622C41.4015 15.907 42.2484 16.754 43.2933 16.754C44.3381 16.754 45.185 15.907 45.185 14.8622V11.6031C45.185 10.3814 45.525 9.48687 46.206 8.92726C46.8867 8.36764 47.8149 8.17059 48.9911 8.33611C49.0423 8.33611 49.0838 8.29459 49.0838 8.24337V5.95572C49.0838 5.49746 48.7994 5.11235 48.3411 5.11235C46.9798 5.11235 45.8963 5.76656 45.0919 7.08284Z"
                      fill="white"
                    />
                    <path
                      d="M58.1754 13.4516C57.7647 14.0113 57.1964 14.2912 56.4691 14.2912C55.6641 14.2912 55.0373 14.0035 54.5887 13.428C54.1397 12.8565 53.9153 12.0958 53.9153 11.1578C53.9153 10.1842 54.1323 9.3999 54.5654 8.79292C54.9985 8.18989 55.6102 7.8864 56.3988 7.8864C57.1886 7.8864 57.7843 8.17803 58.1868 8.76136C58.5889 9.34469 58.7903 10.1409 58.7903 11.1578C58.7903 12.1274 58.5852 12.892 58.1754 13.4516ZM57.5371 4.95397C56.0511 4.95397 54.8519 5.52939 53.939 6.67634H53.8696C53.8696 5.91013 53.2484 5.28899 52.4822 5.28899H52.0589C51.0589 5.28899 50.2482 6.09967 50.2482 7.09968V18.6465C50.2482 19.6913 51.0952 20.5383 52.14 20.5383C53.1848 20.5383 54.0318 19.6913 54.0318 18.6465V15.5682H54.078C54.8674 16.5969 55.989 17.1132 57.444 17.1132C59.0069 17.1132 60.2604 16.5614 61.2039 15.4539C62.1481 14.3503 62.6205 12.8723 62.6205 11.0198C62.6205 9.26195 62.1596 7.80755 61.2394 6.66849C60.3185 5.52548 59.0841 4.95397 57.5371 4.95397Z"
                      fill="white"
                    />
                    <path
                      d="M67.4571 7.08284H67.3877C67.3877 6.09252 66.5764 5.2897 65.586 5.2897C64.5862 5.2897 63.7671 6.10019 63.7671 7.09999V14.8624C63.7671 15.9071 64.614 16.754 65.6587 16.754C66.7034 16.754 67.5503 15.9071 67.5503 14.8624V11.6031C67.5503 10.3814 67.8902 9.48687 68.5717 8.92726C69.2519 8.36764 70.1801 8.17059 71.3568 8.33611C71.4078 8.33611 71.4491 8.29477 71.4491 8.24378V5.95531C71.4491 5.49721 71.1649 5.11235 70.7068 5.11235C69.3451 5.11235 68.262 5.76656 67.4571 7.08284Z"
                      fill="white"
                    />
                    <path
                      d="M72.5204 14.8624C72.5204 15.9071 73.3673 16.754 74.412 16.754C75.4567 16.754 76.3036 15.9071 76.3036 14.8624V7.18129C76.3036 6.1366 75.4567 5.2897 74.412 5.2897C73.3673 5.2897 72.5204 6.13659 72.5204 7.18129V14.8624Z"
                      fill="white"
                    />
                    <path
                      d="M76.4286 3.16785C77.2763 2.16855 76.5661 0.634642 75.2556 0.634642C74.6265 0.634642 74.0608 1.01779 73.8273 1.60202L73.7041 1.91041C73.3146 2.88512 74.0324 3.94507 75.0821 3.94507C75.5179 3.94507 75.9318 3.75346 76.2137 3.4211L76.4286 3.16785Z"
                      fill="white"
                    />
                    <path
                      d="M92.3806 4.95342C90.7866 4.95342 89.5408 5.62345 88.6436 6.96747H88.597C87.9314 5.62345 86.8175 4.95342 85.2546 4.95342C83.6762 4.95342 82.4766 5.61164 81.6566 6.92413H81.5871C81.5871 6.02077 80.8548 5.28844 79.9514 5.28844H79.7766C78.7767 5.28844 77.9661 6.09903 77.9661 7.09893V14.8622C77.9661 15.907 78.8131 16.754 79.8579 16.754C80.9027 16.754 81.7497 15.907 81.7497 14.8622V10.3256C81.7497 9.62403 81.9156 9.06038 82.2486 8.63864C82.5812 8.21297 83.0413 8.00017 83.6297 8.00017C84.7439 8.00017 85.3008 8.6465 85.3008 9.94716V14.8622C85.3008 15.907 86.1478 16.754 87.1926 16.754C88.2374 16.754 89.0844 15.907 89.0844 14.8622V10.3256C89.0844 9.62403 89.2507 9.06038 89.5837 8.63864C89.9167 8.21297 90.3764 8.00017 90.9648 8.00017C92.079 8.00017 92.6359 8.6465 92.6359 9.94716V14.862C92.6359 15.907 93.483 16.754 94.5279 16.754C95.5729 16.754 96.4199 15.907 96.4199 14.862V9.29683C96.4199 7.96857 96.0751 6.91234 95.3866 6.12799C94.6981 5.34365 93.6962 4.95342 92.3806 4.95342Z"
                      fill="white"
                    />
                    <path
                      d="M101.157 9.79049C101.435 8.29686 102.248 7.55206 103.594 7.55206C104.212 7.55206 104.727 7.75301 105.137 8.15499C105.547 8.56091 105.783 9.10476 105.845 9.79049H101.157ZM107.586 6.38947C106.503 5.43181 105.149 4.95494 103.524 4.95494C101.729 4.95494 100.263 5.53029 99.1257 6.67712C97.9887 7.82788 97.4196 9.26639 97.4196 11.0004C97.4196 12.7778 97.9961 14.236 99.149 15.3749C100.302 16.5178 101.838 17.0892 103.756 17.0892C105.196 17.0892 106.433 16.7384 107.47 16.0369C107.757 15.8457 108.015 15.6396 108.244 15.4186C109.14 14.5546 108.258 13.3295 107.013 13.3295C106.26 13.3295 105.624 13.8773 104.955 14.2234C104.639 14.3869 104.255 14.4685 103.802 14.4685C103.044 14.4685 102.441 14.2517 101.992 13.8103C101.543 13.3689 101.257 12.7542 101.133 11.962H107.746C108.815 11.962 109.717 11.0943 109.531 10.0416C109.26 8.50984 108.612 7.29296 107.586 6.38947Z"
                      fill="white"
                    />
                    <path
                      d="M113.851 13.8973C113.489 13.5742 113.033 13.4126 112.48 13.4126C111.936 13.4126 111.483 13.5742 111.122 13.8973C110.76 14.2205 110.579 14.6383 110.579 15.1545C110.579 15.6669 110.758 16.0806 111.115 16.3999C111.473 16.7191 111.928 16.8767 112.48 16.8767C113.04 16.8767 113.499 16.7191 113.857 16.3999C114.214 16.0806 114.394 15.6669 114.394 15.1545C114.394 14.6383 114.213 14.2205 113.851 13.8973Z"
                      fill="white"
                    />
                    <path
                      d="M58.3196 0.551378C58.0281 0.20201 57.5965 5.65052e-05 57.1415 5.65052e-05H55.2306C54.6233 5.65052e-05 54.0801 0.378006 53.869 0.947467C53.5174 1.89594 54.219 2.9043 55.2306 2.9043H57.4431C57.7142 2.9043 57.9789 2.82136 58.2015 2.66663C58.8422 2.2214 58.9633 1.3227 58.4635 0.723722L58.3196 0.551378Z"
                      fill="white"
                    />
                  </svg>
                </div>
              </div>
              <div className={`col-span-2`}>0.044 Pips</div>
              <div className={`col-span-2`}>0 USD</div>
              <div className={`col-span-2`}>0.044 pips or lower</div>
              <div className={`col-span-2`}>USD $0.50/lot</div>
            </div>
            {/* ##Ends */}

            {/* #### */}
            <div
              className={`${styles.costCompareTableRow} grid grid-cols-12 gap-5`}
            >
              <div className={`col-span-4 relative`}>IC Markets RAW</div>
              <div className={`col-span-2`}>0.044 Pips</div>
              <div className={`col-span-2`}>USD $5</div>
              <div className={`col-span-2`}>0.1 pips or lower</div>
              <div className={`col-span-2`}>USD $0.50/lot</div>
            </div>
            {/* ##Ends */}

            {/* #### */}
            <div
              className={`${styles.costCompareTableRow} grid grid-cols-12 gap-5`}
            >
              <div className={`col-span-4 relative`}>FIX PIG</div>
              <div className={`col-span-2`}>0.044 Pips</div>
              <div className={`col-span-2`}>USD $5</div>
              <div className={`col-span-2`}>0.1 pips or lower</div>
              <div className={`col-span-2`}>USD $0.50/lot</div>
            </div>
            {/* ##Ends */}

            {/* #### */}
            <div
              className={`${styles.costCompareTableRow} grid grid-cols-12 gap-5`}
            >
              <div className={`col-span-4 relative`}>Darwinex</div>
              <div className={`col-span-2`}>0.044 Pips</div>
              <div className={`col-span-2`}>USD $5</div>
              <div className={`col-span-2`}>0.1 pips or lower</div>
              <div className={`col-span-2`}>USD $0.50/lot</div>
            </div>
            {/* ##Ends */}

            {/* #### */}
            <div
              className={`${styles.costCompareTableRow} grid grid-cols-12 gap-5`}
            >
              <div className={`col-span-4 relative`}>AAAFX</div>
              <div className={`col-span-2`}>0.044 Pips</div>
              <div className={`col-span-2`}>USD $5</div>
              <div className={`col-span-2`}>0.1 pips or lower</div>
              <div className={`col-span-2`}>USD $0.50/lot</div>
            </div>
            {/* ##Ends */}

            {/* #### */}
            <div
              className={`${styles.costCompareTableRow} grid grid-cols-12 gap-5`}
            >
              <div className={`col-span-4 relative`}>Dukascopy</div>
              <div className={`col-span-2`}>0.044 Pips</div>
              <div className={`col-span-2`}>USD $5</div>
              <div className={`col-span-2`}>0.1 pips or lower</div>
              <div className={`col-span-2`}>USD $0.50/lot</div>
            </div>
            {/* ##Ends */}
          </div>
        </div>

        <div
          className={`flex gap-1 text-[14px] w-full justify-center items-center mt-10`}
        >
          <svg
            width="25"
            height="25"
            viewBox="0 0 25 25"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M11.0645 2.50293C11.6488 1.83419 12.6882 1.83419 13.2725 2.50293C14.0639 3.40906 15.3091 3.77476 16.4648 3.44043C17.3181 3.19354 18.1934 3.75606 18.3232 4.63477C18.4993 5.82482 19.349 6.80496 20.502 7.14844C21.3532 7.40209 21.7847 8.3488 21.4189 9.1582C20.9237 10.2545 21.1084 11.5389 21.8926 12.4512C22.4715 13.1248 22.3234 14.1545 21.5781 14.6377C20.5689 15.2922 20.0299 16.4718 20.1963 17.6631C20.3192 18.5428 19.6382 19.3295 18.75 19.333C17.5469 19.3378 16.4553 20.0394 15.9512 21.1318C15.5789 21.938 14.581 22.2309 13.832 21.7539C12.8173 21.1074 11.5196 21.1074 10.5049 21.7539C9.7559 22.2309 8.75803 21.938 8.38574 21.1318C7.88162 20.0394 6.79006 19.3378 5.58691 19.333C4.69869 19.3295 4.01768 18.5428 4.14062 17.6631C4.30699 16.4718 3.76799 15.2922 2.75879 14.6377C2.01347 14.1545 1.86538 13.1248 2.44434 12.4512C3.22854 11.5389 3.41322 10.2545 2.91797 9.1582C2.55218 8.34881 2.98377 7.4021 3.83496 7.14844C4.98791 6.80496 5.83762 5.82482 6.01367 4.63477C6.14355 3.75606 7.01881 3.19354 7.87207 3.44043C9.02778 3.77477 10.273 3.40906 11.0645 2.50293Z"
              fill="#3EA0EA"
              stroke="#58B7FF"
              strokeWidth="1.62935"
            />
            <path
              d="M7.53143 12.3252L8.93059 10.8673L12.6617 14.7552L11.2625 16.2132L7.53143 12.3252Z"
              fill="white"
            />
            <path
              d="M15.6932 8.6803L17.0924 10.1383L11.2625 16.2132L9.86337 14.7552L15.6932 8.6803Z"
              fill="white"
            />
          </svg>
          Verified as the Lowest Cost Broker on
          <Link className={`underline`} href={"#"}>
            ForexBenchmark
          </Link>
        </div>
      </div>
    </section>
  );
}
